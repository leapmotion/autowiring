language: cpp
sudo: false

matrix:
  include:
  # - os: linux
    # env:
    # - _CC=gcc-4.8
    # - _CXX=g++-4.8
    # - CMAKE_URL=http://www.cmake.org/files/v3.1/cmake-3.1.0-Linux-i386.tar.gz
    # - CMAKE_DIRNAME=cmake-3.1.0-Linux-i386
    # - ADDITIONAL_CMAKE_FLAGS=
    # addons:
      # apt:
        # sources:
          # - ubuntu-toolchain-r-test
        # packages:
          # - gcc-4.8
          # - g++-4.8
          # - libc6-i386
  - os: linux
    env:
    - _CC=arm-linux-gnueabihf-gcc
    - _CXX=arm-linux-gnueabihf-g++
    - CMAKE_URL=http://www.cmake.org/files/v3.1/cmake-3.1.0-Linux-x86_64.tar.gz
    - CMAKE_DIRNAME=cmake-3.1.0-Linux-x86_64
    - ADDITIONAL_CMAKE_FLAGS=-DCMAKE_TOOLCHAIN_FILE=toolchain-arm.cmake
    addons:
      apt:
        sources:
        - ubuntu-toolchain-r-test
        - debian-sid
        packages:
        - g++-4.9-arm-linux-gnueabi 
        - gcc-4.9-arm-linux-gnueabi
        - libstdc++-arm-none-eabi-newlib
  # - os: osx
    # env:
    # - _CC=clang
    # - _CXX=clang++
    # - CMAKE_URL=http://www.cmake.org/files/v3.1/cmake-3.1.0-Darwin64.tar.gz
    # - CMAKE_DIRNAME=cmake-3.1.0-Darwin64/CMake.app/Contents
    # - ADDITIONAL_CMAKE_FLAGS=

before_install:
  # Enforce whitespace guidelines
  - ./scripts/whitespace_check.sh

  # Enforce Leap Motion copyright notice
  - ./scripts/copyright_check.sh

  # Verify that our version numbers all line up
  - ./scripts/version_number_updated.sh

install:
  # CMake 3.1
  - curl $CMAKE_URL | tar xz
  - ls $CMAKE_DIRNAME
  - ls $CMAKE_DIRNAME/bin
  - $CMAKE_DIRNAME/bin/cmake --version
  - export CC=$_CC
  - export CXX=$_CXX
  - ls /usr/bin
  - ls /usr/local/bin
  - $CXX --version

before_script:
  - $CMAKE_DIRNAME/bin/cmake . -DCMAKE_BUILD_TYPE=Release -DCMAKE_INSTALL_PREFIX:PATH=~/autowiring/ $ADDITIONAL_CMAKE_FLAGS

script:
  # Build Autowriring, run unit tests, and install
  - make -j 4 || make
  - ctest --output-on-failure
  - make install
  - cpack || (cat _CPack_Packages/Linux/TGZ/InstallOutput.log; exit 3)
  - cd examples
  - ../$CMAKE_DIRNAME/bin/cmake . -DCMAKE_PREFIX_PATH:PATH=~
  - make


after_failure:
  - cat Testing/Temporary/LastTest.log 2> /dev/null